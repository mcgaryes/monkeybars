<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>..&#x2F;source&#x2F;core.js - MonkeyBars</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0pr2&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0pr2&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title="MonkeyBars"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.9.10</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/MonkeyBars.html">MonkeyBars</a></li>
            
                <li><a href="..&#x2F;classes/ParallelTask.html">ParallelTask</a></li>
            
                <li><a href="..&#x2F;classes/SequenceTask.html">SequenceTask</a></li>
            
                <li><a href="..&#x2F;classes/Task.html">Task</a></li>
            
                <li><a href="..&#x2F;classes/TaskGroup.html">TaskGroup</a></li>
            
                <li><a href="..&#x2F;classes/WorkerTask.html">WorkerTask</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: ..&#x2F;source&#x2F;core.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;&#x2F;%pre

&quot;use strict&quot;;

&#x2F;&#x2F; ===================================================================
&#x2F;&#x2F; === Constants =====================================================
&#x2F;&#x2F; ===================================================================

var STATE_INITIALIZED = 0;
var STATE_STARTED = 1;
var STATE_CANCELED = 2;
var STATE_FAULTED = 3;
var STATE_COMPLETED = 4;

var TYPE_PARALLEL = &quot;parallel&quot;;
var TYPE_SEQUENCE = &quot;sequence&quot;;
var TYPE_SIMPLE = &quot;simple&quot;;

var LOG_NONE = 0;
var LOG_ERROR = 10;
var LOG_INFO = 20;
var LOG_VERBOSE = 30;

var TID_PREFIX = &quot;task&quot;;
var TIMEOUT_INTERVAL = 100;
var OVERRIDE_NEEDED = &quot;Override Needed&quot;;
var UNDEFINED_TASK = &quot;Undefined Task&quot;;
var MISSING_ATTRIBUTES = &quot;No Attributes&quot;;
var UNKNOW_TYPE = &quot;Unknown Task Type&quot;;
var INVALID_ARGUMENTS = &quot;Invalid Arguments&quot;;
var UNHANDLED_POST_MESSAGE = &quot;Unhandled &#x27;postMessage&#x27;&quot;;

&#x2F;&#x2F; ===================================================================
&#x2F;&#x2F; === Private Variables =============================================
&#x2F;&#x2F; ===================================================================

&#x2F;**
 * Reference to the global js object (i.e. brower&#x27;s window)
 *
 * @property root
 * @type Object
 * @private
 *&#x2F;
var root = this;

&#x2F;**
 * Counter used to create unique task ids
 *
 * @property taskIdCounter
 * @type Integer
 * @private
 *&#x2F;
var taskIdCounter = 0;

&#x2F;**
 * List of all whitelisted properties for a task
 *
 * @property taskOptions
 * @type Array
 * @private
 *&#x2F;
var taskOptions = [
	&#x2F;&#x2F; task
	&quot;name&quot;, &quot;tid&quot;, &quot;id&quot;, &quot;data&quot;, &quot;type&quot;, &quot;concurrent&quot;, &quot;worker&quot;, &quot;displayName&quot;, &quot;state&quot;, &quot;logLevel&quot;, &quot;timeout&quot;, &quot;dependencies&quot;, &quot;group&quot;, &quot;processed&quot;,
	&#x2F;&#x2F; group
	&quot;tasks&quot;, &quot;currentIndex&quot;, &quot;processedIndex&quot;, &quot;max&quot;, &quot;dependencyMap&quot;,
	&#x2F;&#x2F; decorators
	&quot;count&quot;, &quot;interval&quot;
];

&#x2F;**
 * Object returned by module. Works as namespace for the task library.
 *
 * @property MonkeyBars
 * @type Object
 *&#x2F;
var MonkeyBars = root.MonkeyBars = {};

&#x2F;&#x2F; ===================================================================
&#x2F;&#x2F; === NodeJS Conditional ============================================
&#x2F;&#x2F; ===================================================================

if(typeof exports !== &#x27;undefined&#x27;) {
	if(typeof(module) !== &#x27;undefined&#x27; &amp;&amp; module.exports) {
		exports = module.exports = MonkeyBars;
	}
}

&#x2F;&#x2F; ===================================================================
&#x2F;&#x2F; === Helper Methods ================================================
&#x2F;&#x2F; ===================================================================

&#x2F;**
 * Creates task based on the options passed.
 *
 * @method createTaskWithOptions
 * @param {Object} options
 * @private
 *&#x2F;
var createTaskWithOptions = function(attributes) {

	&#x2F;&#x2F; check for attributes
	if(!attributes) {
		if(attributes.logLevel &gt;= LOG_ERROR) {
			console.log(MISSING_ATTRIBUTES);
		}
		return;
	}

	var task;

	&#x2F;&#x2F; if the attributes passes already has a tid then we know that
	&#x2F;&#x2F; its an already initialized Task object... else we need to create
	&#x2F;&#x2F; a task from the attributes passed
	if(attributes.tid) {

		task = attributes;

	} else {

		var type = attributes.type;
		var tasks = attributes.tasks;

		&#x2F;&#x2F; create any subtasks
		if(tasks) {
			attributes.tasks = createSubTasksFromTaskOptionsArray(tasks);
		}

		if(type) {
			if(type === TYPE_SIMPLE) {
				task = new Task(attributes);
			} else if(type === TYPE_SEQUENCE) {
				task = new SequenceTask(attributes);
			} else if(type === TYPE_PARALLEL) {
				task = new ParallelTask(attributes);
			} else {
				throw UNKNOW_TYPE;
			}
		} else {
			if(!tasks) {
				task = new Task(attributes);
			} else {
				task = new SequenceTask(attributes);
			}
		}

	}

	return task;
};

&#x2F;**
 * Creates an array of tasks based on the options array passed.
 *
 * @method createSubTasksFromTaskOptionsArray
 * @param {Array} tasks
 * @private
 *&#x2F;
var createSubTasksFromTaskOptionsArray = function(tasks) {
	var tempTasks = [];
	if(tasks) {
		for(var i = 0; i &lt; tasks.length; i++) {
			tempTasks.push(createTaskWithOptions(tasks[i]));
		}
	}
	return tempTasks;
};

&#x2F;**
 * Creates property descriptors from the passes attributes.
 *
 * @method createPropertyDescriptorsWithAttributes
 * @param {Object} attributes
 * @private
 *&#x2F;
var createPropertyDescriptorsWithAttributes = function(attributes) {
	var descriptors = {};
	for(var attribute in attributes) {
		descriptors[attribute] = {
			value: attributes[attribute],
			writable: true
		};
	}
	return descriptors;
};

&#x2F;**
 * Generates a unique id for each task.
 *
 * @method generateUniqueId
 * @param {String} prefix
 * @return {String} tid
 * @private
 *&#x2F;
var generateUniqueId = function(prefix) {
	var id = taskIdCounter++;
	var tid = prefix ? prefix + id : TID_PREFIX + id;
	return tid;
};

&#x2F;**
 * Determains whether the first task is dependent on the second.
 *
 * @method isTaskDependentOnTask
 * @param {Task} task1
 * @param {Task} task2
 * @private
 *&#x2F;
var isTaskDependentOnTask = function(task1, task2) {
	var dependencies = task1.dependencies;
	if(dependencies) {
		var totalDependencies = dependencies.length;
		for(var i = 0; i &lt; totalDependencies; i++) {
			var dependency = dependencies[i];
			if(dependency.tid === task2.tid) {
				return true;
			} else if(dependency === task2.id) {
				return true;
			} else if(dependency === task2.name &amp;&amp; task2.name !== &quot;undefined&quot;) {
				return true;
			}
		}
	}
	return false;
};

&#x2F;**
 * Variation of http:&#x2F;&#x2F;blog.stchur.com&#x2F;2007&#x2F;04&#x2F;06&#x2F;serializing-objects-in-javascript&#x2F;
 *
 * @method serialize
 * @param {Object} o
 * @return {String} Serialized string representation of the passed object
 * @private
 *&#x2F;
var serialize = function(o) {

	&#x2F;&#x2F; Let Gecko browsers do this the easy way
	if(typeof o.toSource !== &#x27;undefined&#x27; &amp;&amp; typeof o.callee === &#x27;undefined&#x27;) {

		return o.toSource();

	}

	&#x2F;&#x2F; Other browsers must do it the hard way
	if(typeof o === &quot;number&quot; || typeof o === &quot;boolean&quot; || typeof o === &quot;function&quot;) {
		return o;

	} else if(typeof o === &quot;string&quot;) {

		return &#x27;\&#x27;&#x27; + o + &#x27;\&#x27;&#x27;;

	} else if(typeof o === &quot;object&quot;) {

		var str;
		if(o.constructor === Array || typeof o.callee !== &#x27;undefined&#x27;) {
			str = &#x27;[&#x27;;
			var i, len = o.length;
			for(i = 0; i &lt; len - 1; i++) {
				str += serialize(o[i]) + &#x27;,&#x27;;
			}
			str += serialize(o[i]) + &#x27;]&#x27;;
		} else {
			str = &#x27;{&#x27;;
			var key;
			for(key in o) {
				str += key + &#x27;:&#x27; + serialize(o[key]) + &#x27;,&#x27;;
			}
			str = str.replace(&#x2F;\,$&#x2F;, &#x27;&#x27;) + &#x27;}&#x27;;
		}
		return str;

	} else {

		return &#x27;UNKNOWN&#x27;;

	}
};

&#x2F;**
 * Creates a blob string to be used with the web worker for concurrent task execution
 *
 * @method createBlobWithTask
 * @param {Task} task
 * @return {Blob} Blob instance
 * @private
 *&#x2F;
var createBlobWithTask = function(task) {

	&#x2F;&#x2F; create a console wrapper
	var consoleString = &quot;var console = { log: function(msg) { postMessage({ type: &#x27;console&#x27;, message: msg }); } };&quot;;

	var workerTask;

	if(task.worker !== undefined) {
		if(typeof(task.worker) === &quot;function&quot;) {
			workerTask = new task.worker(task);
		} else if(task.worker.constructor !== undefined &amp;&amp; typeof(task.worker.constructor) === &quot;function&quot;) {
			workerTask = new task.worker.constructor(task);
		}
	} else {
		workerTask = new WorkerTask(task);
	}

	var workerString = &quot;var workerTask = &quot; + serialize(workerTask) + &quot;; workerTask.performTask();&quot;;
	var blobString = &quot;onmessage = function(e) {&quot; + consoleString + workerString + &quot;};&quot;;

	return new Blob([blobString], {
		type: &quot;text\&#x2F;javascript&quot;
	});

};

&#x2F;**
 * Creates a web Worker instance with the passed arguments
 *
 * @method createWebWorkerWithBlobAndTask
 * @param {Blob} blob
 * @param {Task} task
 * @return {Worker} WebWorker instance
 * @private
 *&#x2F;
var createWebWorkerWithBlobAndTask = function(blob, task) {

	&#x2F;&#x2F; @TODO: Need to figure out what the other browser prefixes for window.URL
	var URL = root.URL || root.webkitURL;

	&#x2F;&#x2F; create our worker
	var worker = new Worker(URL.createObjectURL(blob));

	&#x2F;&#x2F; assign worker on message callback
	worker.onmessage = function(e) {
		if(e.data.type === &quot;complete&quot;) {
			task.complete(e.data.value);
		} else if(e.data.type === &quot;fault&quot;) {
			task.fault(e.data.value);
		} else if(e.data.type === &quot;cancel&quot;) {
			task.cancel();
		} else if(e.data.type === &quot;console&quot;) {
			console.log(e.data.message);
		} else {
			if(task.worker !== undefined &amp;&amp; typeof(task.worker.handler) === &quot;function&quot;) {
				task.worker.handler(e);
			} else {
				if(task.logLevel &gt; LOG_ERROR) {
					console.log(UNHANDLED_POST_MESSAGE + &quot;: &quot; + serialize(e.data));
				}
			}
		}
	};

	&#x2F;&#x2F; assign worker onerror callback
	worker.onerror = function(e) {
		task.fault(&quot;WebWorker error.&quot;);
	};

	return worker;
};

&#x2F;**
 * Performs the tasks &#x60;performTask&#x60; functionality within a web worker
 *
 * @method performTaskFunctionalityWithWebWorker
 * @param {Task} task
 * @private
 *&#x2F;
var performTaskFunctionalityWithWebWorker = function(task) {

	if(typeof(Worker) === &quot;undefined&quot; || typeof(Blob) === &quot;undefined&quot; || task.type !== TYPE_SIMPLE) {
		task.performTask();
		return;
	}

	&#x2F;&#x2F; create our worker
	var worker = createWebWorkerWithBlobAndTask(createBlobWithTask(task), task);

	&#x2F;&#x2F; start the worker
	worker.postMessage();

};

&#x2F;**
 * @method decorateTaskBasedOnAttributes
 * @param {Task} task
 * @param {Object} attributes
 * @private
 *&#x2F;
var decorateTaskBasedOnAttributes = function(task, attributes) {
	if(task.count) {
		forTaskDecorator(task);
	}
	if(task.when) {
		whenTaskDecorator(task);
	}
	if(task.doWhile) {
		whileTaskDecorator(task);
	}
};

&#x2F;**
 * Extention functionality for various task types.
 *
 * @method extend
 * @for MonkeyBars
 * @param {Object} protoProps
 * @return {Function} child Constructor function for extended task type
 * @example
 *		
 *	var CustomTask = MonkeyBars.Task.extend({
 *		name:&quot;CustomTask&quot;,
 *		newMethod:function(){
 *			console.log(&quot;Executing newMethod&quot;);
 *		}
 *	});
 *	var instance = new CustomTask();
 *
 *&#x2F;
var extend = function(protoProps) {
	var parent = this;
	var child = function() {
			parent.apply(this, arguments);
		};
	var childProto = createPropertyDescriptorsWithAttributes(protoProps);
	child.prototype = Object.create(parent.prototype, childProto);
	return child;
};

&#x2F;&#x2F; ===================================================================
&#x2F;&#x2F; === Worker Task ===================================================
&#x2F;&#x2F; ===================================================================

&#x2F;&#x2F;%worker

&#x2F;&#x2F; ===================================================================
&#x2F;&#x2F; === Simple Task ===================================================
&#x2F;&#x2F; ===================================================================

&#x2F;&#x2F;%simple

&#x2F;&#x2F; ===================================================================
&#x2F;&#x2F; === Task Group ====================================================
&#x2F;&#x2F; ===================================================================

&#x2F;&#x2F;%group

&#x2F;&#x2F; ===================================================================
&#x2F;&#x2F; === Parallel Task =================================================
&#x2F;&#x2F; ===================================================================

&#x2F;&#x2F;%parallel

&#x2F;&#x2F; ===================================================================
&#x2F;&#x2F; === Sequence Task =================================================
&#x2F;&#x2F; ===================================================================

&#x2F;&#x2F;%sequence

&#x2F;&#x2F; ===================================================================
&#x2F;&#x2F; === Task Decorators ===============================================
&#x2F;&#x2F; ===================================================================

&#x2F;&#x2F;%decorators

&#x2F;&#x2F; ===================================================================
&#x2F;&#x2F; === Public Interface ==============================================
&#x2F;&#x2F; ===================================================================

&#x2F;**
 * Task states contstants.
 *
 * @property TaskStates
 * @for MonkeyBars
 * @type Object
 * @static
 *&#x2F;
MonkeyBars.TaskStates = {
	Initialized: STATE_INITIALIZED,
	Started: STATE_STARTED,
	Canceled: STATE_CANCELED,
	Faulted: STATE_FAULTED,
	Completed: STATE_COMPLETED
};

&#x2F;**
 * Task types contstants.
 *
 * @property TaskTypes
 * @for MonkeyBars
 * @type Object
 * @static
 *&#x2F;
MonkeyBars.TaskTypes = {
	Parallel: TYPE_PARALLEL,
	Sequence: TYPE_SEQUENCE,
	Simple: TYPE_SIMPLE
};

&#x2F;**
 * Log level contstants.
 *
 * @property LogLevels
 * @for MonkeyBars
 * @type Object
 * @static
 *&#x2F;
MonkeyBars.LogLevels = {
	None: LOG_NONE,
	Error: LOG_ERROR,
	Info: LOG_INFO,
	Verbose: LOG_VERBOSE
};

&#x2F;&#x2F;%post
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
