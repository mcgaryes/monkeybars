(function(){var e=0,t=1,n=2,r=3,i=4,s="parallel",o="sequence",u="simple",a=function(e){var t;if(!e)throw"No options passed";var n=e.type,r=e.tasks;return n?n==u?l.extend(e):n==o?p.extend(e):n==s?h.extend(e):t:r?p.extend(e):l.extend(e)},f=function(e){var t=[];if(e)for(var n=0;n<e.length;n++)t.push(a(e[n]));return t},l={prototype:{type:u,name:u,state:e,cancel:function(){if(this.state>t)return;this.state=n,this.loggingEnabled&&console.log("Canceled:"+this.name),this.onChange(this.state),this.onCancel()},complete:function(){if(this.state>t)return;this.state=i,this.loggingEnabled&&console.log("Completed:"+this.name),this.onChange(this.state),this.onComplete()},fault:function(e){if(this.state>=n)return;this.state=r,this.loggingEnabled&&console.log("Faulted:"+this.name),this.onChange(this.state,e),this.onFault(e)},onChange:function(e,t){},onFault:function(e){},onComplete:function(){},onCancel:function(){},performTask:function(){throw"'performTask' method should be overridden"},start:function(){if(this.state>=t)return;this.state=t,this.loggingEnabled&&console.log("Started:"+this.name),this.onChange(this.state),this.performTask()}},extend:function(e){var t=l.prototype,n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n}},c={prototype:{addSubTask:function(e){e.id||(e=a(e)),this.tasks.push(e)},addSubTaskAfterTask:function(e,t){if(!e||this.state==n)return;e.id||(e=a(e));var r=this.tasks.indexOf(t);this.tasks.splice(r,0,e)},onSubTaskComplete:function(){throw"This is an abstract method and must be implemented in a subclass."},onSubTaskFault:function(e){this.fault(e)},onSubTaskCancel:function(e){this.cancel()},processSubTask:function(e){if(!e)throw"You cannot process a task with a nil value.";return e.state==n?(console.log("task is canceled"),this.onSubTaskCancel(e),!0):(e.group=this,e.loggingEnabled=this.loggingEnabled,e.onChange=function(t,s){t==i?this.group.onSubTaskComplete():t==r?this.group.onSubTaskFault(s):t==n&&this.group.onSubTaskCancel(e)},e.start(),!1)},removeSubTask:function(e){if(!e)return;var t=this.tasks.indexOf(e);this.tasks.splice(t,1)}},extend:function(e){var t=l.extend(c.prototype),n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n}},h={prototype:{type:s,name:s,currentIndex:0,hasNoEnabledSubTasks:function(){for(var e=0;e<this.tasks.length;e++){var t=this.tasks[e];if(t.state!=n)return!1}return!0},processSubTasks:function(){for(var e=0;e<this.tasks.length;e++){var t=this.tasks[e];this.currentIndex++,this.processSubTask(t)}},addSubTask:function(e){if(!e||e.state==n)return;this.currentIndex++,e.id||(e=new l(e)),this.tasks.push(e),this.processSubTask(e)},onSubTaskComplete:function(){this.currentIndex--<=1&&this.complete()},performTask:function(){this.hasNoEnabledSubTasks()?this.complete():this.processSubTasks()}},extend:function(e){var t=c.extend(h.prototype),n={};for(var r in t)n[r]=t[r];e||(e={}),e.tasks=f(e.tasks);for(var r in e)n[r]=e[r];return n}},p={prototype:{type:o,name:o,currentIndex:0,startNextSubTask:function(){if(this.state>=n)return;if(this.tasks&&this.currentIndex<this.tasks.length){var e=this.processSubTask(this.tasks[this.currentIndex++]);e&&this.startNextSubTask()}else this.complete()},onSubTaskComplete:function(){if(this.state==n)return;this.startNextSubTask()},onSubTaskCancel:function(e){this.state!=n&&this.startNextSubTask()},performTask:function(){this.startNextSubTask()}},extend:function(e){var t=c.extend(p.prototype),n={};for(var r in t)n[r]=t[r];e||(e={}),e.tasks=f(e.tasks);for(var r in e)n[r]=e[r];return n}};this.MonkeyBars={TaskStates:{Initialized:e,Started:t,Canceled:n,Faulted:r,Completed:i},TaskTypes:{Parallel:s,Sequence:o,Simple:u},Task:l,ParallelTask:h,SequenceTask:p}})(this);